const tape = require('tape')
const Hypercore = require('hypercore')
const ram = require('random-access-memory')
const OrderBook = require('./')

tape('append and get', async function (t) {
  const book = new OrderBook(new Hypercore(ram), 'BTC')
  const now = new Date()

  const entry = {
    date: now,
    book: [
      [1, 2, 3],
      [0.038366, 1, 20000],
      [0.038365, 1, 85055.51104],
      [0.03827, 1, 3000],
      [0.03808, 1, 326.06354],
      [0.038077, 1, 466204.48106],
      [0.037792, 1, 983167.34861],
      [0.037501, 1, 2454.49060771],
      [0.0375, 1, 306614.572539],
      [0.0361, 1, 71232.223418],
      [0.036, 1, 4884.18754],
      [0.032112, 1, 6228],
      [0.032106, 1, 12000],
      [0.03105, 1, 12172.854929],
      [0.030101, 1, 1000000],
      [0.03, 2, 8014.34],
      [0.028988, 1, 0.03886747],
      [0.026001, 1, 317.63834627],
      [0.026, 1, 100000],
      [0.025, 1, 100000],
      [0.024, 2, 100000],
      [0.023, 1, 61411.865722],
      [0.022129, 1, 15000],
      [0.022, 1, 196858.875784],
      [0.0216, 1, 20000],
      [0.021, 2, 19298.15236425],
      [0.02, 1, 185000],
      [0.0199, 1, 2426.491195],
      [0.019553, 1, 2557.15235514],
      [0.01777, 1, 2813.73100732],
      [0.017, 1, 50000],
      [0.01671, 1, 1920],
      [0.016, 1, 40000],
      [0.015211, 1, 3287.09486556],
      [0.015, 2, 100000],
      [0.012, 1, 100000],
      [0.011, 1, 200000.804503],
      [0.0107, 1, 300000],
      [0.0106, 1, 300000],
      [0.01, 1, 349.193],
      [0.0085, 1, 9500],
      [0.00795, 1, 411.850202],
      [0.0055287, 1, 14735],
      [0.0055104, 1, 12211],
      [0.0005, 1, 75196.000007],
      [0.038558, 1, -94597.67177],
      [0.03866, 1, -0.57938],
      [0.038807, 1, -28611.495983],
      [0.038847, 1, -498192.22823],
      [0.039054, 1, -90957.49227542],
      [0.039138, 1, -969216.52052],
      [0.03914, 1, -0.3337],
      [0.03925, 1, -3000],
      [0.039313, 1, -89673],
      [0.039568, 1, -1074],
      [0.039582, 1, -17135.04306],
      [0.0396, 1, -12500],
      [0.0398, 1, -13022.5378],
      [0.041998, 1, -4073.8636102],
      [0.041999, 1, -58867.506514],
      [0.043, 1, -708208],
      [0.046, 3, -447412],
      [0.047, 4, -555897],
      [0.048, 3, -454520],
      [0.049, 4, -505322],
      [0.05, 5, -825708],
      [0.051, 3, -700000],
      [0.053, 1, -223403],
      [0.06, 1, -200000],
      [0.098, 1, -80000],
      [0.1, 1, -358000],
      [0.102, 1, -20000],
      [0.19, 1, -60000],
      [0.198, 1, -49800.754],
      [0.2, 1, -50000],
      [0.3, 1, -8000],
      [0.5, 1, -4500],
      [0.6, 1, -8000],
      [1, 1, -9023],
      [1.0099, 1, -750000],
      [1.7, 1, -11469.668187],
      [1.8, 1, -5451.789473]
    ]
  }

  await book.append(entry)

  const e = await book.get(entry.date)

  t.same(e, entry)
  t.end()
})
